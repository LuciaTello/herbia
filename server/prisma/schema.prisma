// Prisma Schema: like your @Entity classes in JPA/Hibernate
// Each "model" becomes a table in PostgreSQL AND a TypeScript type

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Like @Entity User in JPA
// In Spring Security, this is often called "AppUser" to avoid conflicts
model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique                        // Like @Column(unique = true)
  passwordHash String   @map("password_hash")          // NEVER store plain passwords!
  createdAt    DateTime @default(now())

  // One-to-many: a user has many treks
  // Like @OneToMany(mappedBy = "user") List<Trek> treks;
  treks        Trek[]

  @@map("users")
}

// A trek represents a search (origin â†’ destination) with its suggested plants
// Like @Entity Trek in JPA
model Trek {
  id          Int              @id @default(autoincrement())
  origin      String
  destination String
  description String           @default("")  // General vegetation overview for this route/month
  month       Int              // 1-12, for seasonal plant suggestions
  year        Int              // e.g. 2026
  createdAt   DateTime         @default(now())

  // Foreign key to User
  userId      Int              @map("user_id")
  user        User             @relation(fields: [userId], references: [id])

  // One-to-many: a trek has many suggested plants
  // cascade delete handled by Prisma (onDelete: Cascade)
  plants      SuggestedPlant[]

  @@map("treks")
}

// A plant suggested by Gemini for a specific trek
// Like @Entity SuggestedPlant in JPA
model SuggestedPlant {
  id             Int       @id @default(autoincrement())
  commonName     String
  scientificName String
  description    String
  imageUrls      String[]  @default([])   @map("image_urls")
  chancePercent  Int       @default(0)    @map("chance_percent")
  found          Boolean   @default(false)
  foundAt        DateTime?

  // Foreign key to Trek (like @ManyToOne @JoinColumn(name = "trek_id") Trek trek;)
  trekId         Int       @map("trek_id")
  trek           Trek      @relation(fields: [trekId], references: [id], onDelete: Cascade)

  @@map("suggested_plants")
}
