<a routerLink="/" class="back-link">{{ i18n.t().collection.back }}</a>

<h2>{{ i18n.t().collection.title }}</h2>

@if (loading()) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-message">{{ i18n.t().collection.loading }}</p>
  </div>
} @else if (collection().length === 0) {
  <div class="empty">
    <p>{{ i18n.t().collection.emptyLine1 }}</p>
    <p>{{ i18n.t().collection.emptyLine2 }}</p>
  </div>
} @else {
  <div class="collection-list">
    @for (found of collection(); track found.id) {
      <article class="found-card">
        <button class="remove-button" (click)="removePlant(found.id)">&times;</button>
        <div class="plant-thumbnail" (click)="openGallery(refPhotos(found.photos), found.commonName)">
          @if (refPhotos(found.photos).length) {
            <img [src]="refPhotos(found.photos)[0].url" [alt]="found.commonName" />
          } @else {
            <div class="no-photo">?</div>
          }
        </div>
        <div class="found-info">
          <h4>{{ found.commonName }}</h4>
          <p class="scientific">{{ found.scientificName }}</p>
          <p class="chance" [style.color]="rarity(found.rarity).color">
            {{ rarity(found.rarity).label }}
          </p>
          <p class="route">{{ found.trek?.origin }} â†’ {{ found.trek?.destination }}</p>
          <p class="date">{{ found.foundAt }}</p>
        </div>
        @if (userPhotos(found.photos).length) {
          <div class="user-photos-box">
            @for (photo of userPhotos(found.photos); track photo.id) {
              <div class="user-photo-wrapper">
                <img class="user-photo-thumb" [src]="photo.url" [alt]="found.commonName"
                     (click)="openGallery(userPhotos(found.photos), found.commonName)" />
                <button class="photo-delete-btn" (click)="deletePhoto(photo.id!, found.id)">&times;</button>
              </div>
            }
          </div>
        }
      </article>
    }
  </div>
}

@if (galleryImages().length) {
  <app-photo-gallery
    [images]="galleryImages()"
    [plantName]="galleryPlantName()"
    (closeGallery)="closeGallery()"
  />
}
