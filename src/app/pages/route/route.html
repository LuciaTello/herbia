<a routerLink="/" class="back-link">{{ i18n.t().route.back }}</a>

<h2>{{ i18n.t().route.title }}</h2>

<div class="mode-toggle">
  <button [class.active]="mode() === 'route'" (click)="setMode('route')">
    {{ i18n.t().route.routeTab }}
  </button>
  <button [class.active]="mode() === 'zone'" (click)="setMode('zone')">
    {{ i18n.t().route.zoneTab }}
  </button>
</div>

<form class="route-form" (ngSubmit)="onSearch()">
  <div class="field">
    <label for="origin">{{ mode() === 'zone' ? i18n.t().route.locationLabel : i18n.t().route.originLabel }}</label>
    <input
      id="origin"
      type="text"
      [placeholder]="mode() === 'zone' ? i18n.t().route.locationPlaceholder : i18n.t().route.originPlaceholder"
      [ngModel]="origin()"
      (ngModelChange)="origin.set($event)"
      name="origin"
      required
      appPlaceAutocomplete
      (placeSelected)="onOriginSelected($event)"
    />
  </div>

  @if (mode() === 'route') {
    <div class="field">
      <label for="destination">{{ i18n.t().route.destinationLabel }}</label>
      <input
        id="destination"
        type="text"
        [placeholder]="i18n.t().route.destinationPlaceholder"
        [ngModel]="destination()"
        (ngModelChange)="destination.set($event)"
        name="destination"
        required
        appPlaceAutocomplete
        (placeSelected)="onDestinationSelected($event)"
      />
    </div>
  }

  <button type="submit" class="primary-button" [disabled]="loading()">
    @if (loading()) {
      {{ i18n.t().route.searching }}
    } @else {
      {{ mode() === 'zone' ? i18n.t().route.searchZone : i18n.t().route.search }}
    }
  </button>
</form>

@if (loading()) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-message">{{ loadingMessage() }}</p>
    <p class="loading-hint">{{ i18n.t().route.loadingHint }}</p>
  </div>
}

@if (error()) {
  <p class="error-message">{{ error() }}</p>
}

@if (tooFar()) {
  <section class="too-far">
    <p class="error-message">{{ i18n.t().route.tooFar }}</p>
  </section>
}

@if (plants().length > 0) {
  <section class="results">
    <h3>{{ mode() === 'zone' ? i18n.t().route.zoneResultsTitle : i18n.t().route.resultsTitle }}</h3>

    @if (description()) {
      <p class="mission-description">{{ description() }}</p>
    }

    @for (plant of plants(); track plant.scientificName) {
      <article class="plant-card">
        <div class="plant-thumbnail" (click)="openGallery(plant.photos, plant.commonName)">
          @if (plant.photos.length) {
            <img [src]="plant.photos[0].url" [alt]="plant.commonName" />
          } @else {
            <div class="no-photo">{{ plant.commonName }}</div>
          }
        </div>
        <div class="plant-info">
          <h4>{{ plant.commonName }}</h4>
          <p class="scientific">{{ plant.scientificName }}</p>
          <p class="chance" [style.color]="rarity(plant.rarity).color">
            {{ rarity(plant.rarity).label }}
          </p>
          <p>{{ plant.description }}</p>
          @if (plant.hint) {
            <p class="hint">{{ plant.hint }}</p>
          }
        </div>
      </article>
    }

    @if (mode() === 'route') {
      <app-route-map [origin]="origin()" [destination]="destination()" />
    }

    <button
      class="primary-button start-mission-button"
      (click)="onStartMission()"
      [disabled]="saving()"
    >
      @if (saving()) {
        {{ i18n.t().route.saving }}
      } @else {
        {{ i18n.t().route.startMission }}
      }
    </button>
  </section>
}

@if (galleryImages().length) {
  <app-photo-gallery
    [images]="galleryImages()"
    [plantName]="galleryPlantName()"
    (closeGallery)="closeGallery()"
  />
}
