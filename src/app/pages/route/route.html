<a routerLink="/" class="back-link">{{ i18n.t().route.back }}</a>

<h2>{{ i18n.t().route.title }}</h2>

<form class="route-form" (ngSubmit)="onSearch()">
  <div class="field">
    <label for="origin">{{ i18n.t().route.originLabel }}</label>
    <input
      id="origin"
      type="text"
      [placeholder]="i18n.t().route.originPlaceholder"
      [ngModel]="origin()"
      (ngModelChange)="origin.set($event)"
      name="origin"
      required
      appPlaceAutocomplete
      (placeSelected)="origin.set($event)"
    />
  </div>

  <div class="field">
    <label for="destination">{{ i18n.t().route.destinationLabel }}</label>
    <input
      id="destination"
      type="text"
      [placeholder]="i18n.t().route.destinationPlaceholder"
      [ngModel]="destination()"
      (ngModelChange)="destination.set($event)"
      name="destination"
      required
      appPlaceAutocomplete
      (placeSelected)="destination.set($event)"
    />
  </div>

  <button type="submit" class="primary-button" [disabled]="loading()">
    @if (loading()) {
      {{ i18n.t().route.searching }}
    } @else {
      {{ i18n.t().route.search }}
    }
  </button>
</form>

@if (loading()) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-message">{{ loadingMessage() }}</p>
    <p class="loading-hint">{{ i18n.t().route.loadingHint }}</p>
  </div>
}

@if (error()) {
  <p class="error-message">{{ error() }}</p>
}

@if (tooFar()) {
  <section class="too-far">
    <p class="error-message">{{ i18n.t().route.tooFar }}</p>
    @if (description()) {
      <p class="trek-description">{{ description() }}</p>
    }
  </section>
}

@if (plants().length > 0) {
  <section class="results">
    <h3>{{ i18n.t().route.resultsTitle }}</h3>

    @if (description()) {
      <p class="trek-description">{{ description() }}</p>
    }

    @for (plant of plants(); track plant.scientificName) {
      <article class="plant-card">
        <div class="plant-thumbnail" (click)="openGallery(plant.photos, plant.commonName)">
          @if (plant.photos.length) {
            <img [src]="plant.photos[0].url" [alt]="plant.commonName" />
          } @else {
            <div class="no-photo">{{ plant.commonName }}</div>
          }
        </div>
        <div class="plant-info">
          <h4>{{ plant.commonName }}</h4>
          <p class="scientific">{{ plant.scientificName }}</p>
          <p class="chance" [style.color]="rarity(plant.rarity).color">
            {{ rarity(plant.rarity).label }}
          </p>
          <p>{{ plant.description }}</p>
        </div>
      </article>
    }

    <app-route-map [origin]="origin()" [destination]="destination()" />

    <button
      class="primary-button start-trek-button"
      (click)="onStartTrek()"
      [disabled]="saving()"
    >
      @if (saving()) {
        {{ i18n.t().route.saving }}
      } @else {
        {{ i18n.t().route.startTrek }}
      }
    </button>
  </section>
}

@if (galleryImages().length) {
  <app-photo-gallery
    [images]="galleryImages()"
    [plantName]="galleryPlantName()"
    (closeGallery)="closeGallery()"
  />
}
